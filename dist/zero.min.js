(function(e){e.noop=function(e){return e},e.uuid=function(){var e=1;return function(){return e++}}(),e.deferred=function(e,t){var n;return function(){n&&clearTimeout(n),n=setTimeout(t.bind(this),e)}},e.Set=function(){function e(e){this.elements=e||[]}var t=e.prototype;return t.has=function(e){return this.elements.indexOf(e)>=0},t.add=function(e){this.has(e)||this.elements.push(e)},t.remove=function(e){var t=this.elements.indexOf(e);t>0&&this.elements.splice(t,1)},t.clear=function(){this.elements=[]},e}(),e.EventHandler=function(){function e(e,t){this.fn=e,this.once=!!t}return e}(),e.EventEmitter=function(){function n(){this._handlers={}}var t=e.EventHandler,r=n.prototype;return r.on=function(e,n){var r=n instanceof t?n:new t(n,!1),i=this._handlers;return i[e]||(i[e]=[]),i[e].push(r),this},r.off=function(e,n){var r,i=this,s=i._handlers;return e?s[e]&&s[e].length>0?n?(r=n instanceof t?n.fn:n,s[e]=s[e].filter(function(e){return e.fn!==r}),i):(s[e]=[],i):i:(s=i._handlers={},i)},r.once=function(e,n){var r=new t(n instanceof t?n.fn:n,!0);return this.on(e,r)},r.emit=function(){var e=arguments[0],t,n=this,r=n._handlers;return r[e]&&r[e].length>0?(t=arguments.length>1?Array.prototype.splice.call(arguments,1):[],r[e]=r[e].filter(function(e){return e.fn.apply(n,t),!e.once}),n):n},n}(),e.Observable=function(){function n(n){var r=this;t.call(r),r.uuid=e.uuid(),r.value=n}var t=e.EventEmitter,r=n.prototype=Object.create(t.prototype);return r.set=function(e){var t=this,n=t.value;return t.emit("set"),n!==e&&(t.value=e,t.emit("change",e,n)),t},r.get=function(){return this.emit("get"),this.value},n}(),e.Computed=function(){function n(n){var r=this;t.call(r),r.uuid=e.uuid(),r.read=n,r.value=undefined,r.shouldRecompute=!0,r.lastContext=undefined}var t=e.EventEmitter,r=n.prototype=Object.create(t.prototype);return r.get=function(e){var t=this,n=t.value,r;return t.lastContext=e,t.emit("get"),t.shouldRecompute&&(t.emit("start"),r=t.read.call(e),t.shouldRecompute=!1,t.emit("end"),n!==r&&(t.value=r,t.emit("change",r,n))),t.value},r.recompute=function(){return this.shouldRecompute=!0,this.get(this.lastContext)},n}(),e.Subscriber=function(){function n(n){var r=this;t.call(r),r.uuid=e.uuid(),r.fn=n,r.lastContext=undefined}var t=e.EventEmitter,r=n.prototype=Object.create(t.prototype);return r.run=function(e){var t=this;return t.lastContext=e,t.emit("start"),t.fn.call(e),t.emit("end"),e},r.rerun=function(){return this.run(this.lastContext)},n}(),e.IsolationCallContext=function(){function t(t){this.uuid=t,this.dependencies=new e.Set,this.relations=new e.Set}return t}(),e.Isolation=function(){function n(){var t=this;t._observables={},t._computed={},t._subscribers={},t._callStack=[],t._currentContext=undefined,t._contexts={},t._computedToRecompute=new e.Set,t._subscribersToRerun=new e.Set,t.resolve=e.deferred(10,t.resolve)}var t=e.IsolationCallContext,r=n.prototype;return r.observable=function(t){var n=new e.Observable(t);return this.registerObservable(n)},r.registerObservable=function(e){function r(t){return arguments.length>0?(e.set(t),this):e.get()}var t=this,n=e.uuid;return t._observables[n]=e,e.on("get",function(){t.registerDependency(n)}),e.on("change",function(){t.registerChanged(n)}),r},r.computed=function(t){var n=new e.Computed(t);return this.registerComputed(n)},r.registerComputed=function(e){function r(){return e.get(this)}var t=this,n=e.uuid;return t._computed[n]=e,e.on("get",function(){t.registerDependency(n)}),e.on("start",function(){t.setContext(n)}),e.on("end",function(){t.closeContext()}),e.on("change",function(){t.registerChanged(n)}),r},r.subscribe=function(t){var n=new e.Subscriber(t);return this.registerSubscriber(n)},r.registerSubscriber=function(e){function r(){return e.run(this)}var t=this,n=e.uuid;return t._subscribers[n]=e,e.on("start",function(){t.setContext(n)}),e.on("end",function(){t.closeContext()}),r},r.setContext=function(e){var n=this,r=n._currentContext,i=n._contexts;r&&n._callStack.unshift(r),i[e]||(i[e]=new t(e)),r=n._currentContext=i[e],r.dependencies.elements.forEach(function(t){n.removeRelation(e,t)}),r.dependencies.clear()},r.closeContext=function(){this._currentContext=this._callStack.shift()},r.registerDependency=function(e){var t=this._currentContext;t&&(t.dependencies.add(e),this.registerRelation(t.uuid,e))},r.registerRelation=function(e,n){var r=this._contexts;r[n]||(r[n]=new t(n)),r[n].relations.add(e)},r.removeRelation=function(e,t){var n=this._contexts[t];n.relations.remove(e)},r.registerChanged=function(e){var t=this,n=t._contexts[e],r;n&&(r=n.relations.elements,r.length>0&&(r.forEach(function(e){if(!t._currentContext||t._currentContext.uuid!==e)t._computed[e]?t._computedToRecompute.add(e):t._subscribers[e]&&t._subscribersToRerun.add(e)}),t.resolve()))},r.resolve=function(){var e=this,t,n;while(e._computedToRecompute.elements.length>0)t=e._computedToRecompute.elements.shift(),e._computed[t].recompute();while(e._subscribersToRerun.elements.length>0)n=e._subscribersToRerun.elements.shift(),e._subscribers[n].rerun()},n}()})(window.Zero={});