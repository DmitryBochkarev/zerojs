(function(e,t){e.noop=function(e){return e},e.uuid=function(){var e=1;return function(){return e++}}(),e.deferred=function(e,t){var n;return function(){n&&clearTimeout(n),n=setTimeout(t.bind(this),e)}},e.Set=function(){function e(e){this.elements=e||[]}var t=e.prototype;return t.has=function(e){return this.elements.indexOf(e)>=0},t.add=function(e){this.has(e)||this.elements.push(e)},t.remove=function(e){var t=this.elements.indexOf(e);t>0&&this.elements.splice(t,1)},t.clear=function(){this.elements=[]},e}(),e.EventHandler=function(){function e(e,t){this.fn=e,this.once=!!t}return e}(),e.EventEmitter=function(){function n(){this._handlers={}}var t=e.EventHandler,r=n.prototype;return r.on=function(e,n){var r=n instanceof t?n:new t(n,!1),i=this._handlers;return i[e]||(i[e]=[]),i[e].push(r),this},r.off=function(e,n){var r,i=this,s=i._handlers;return e?s[e]&&s[e].length>0?n?(r=n instanceof t?n.fn:n,s[e]=s[e].filter(function(e){return e.fn!==r}),i):(s[e]=[],i):i:(s=i._handlers={},i)},r.once=function(e,n){var r=new t(n instanceof t?n.fn:n,!0);return this.on(e,r)},r.emit=function(){var e=arguments[0],t,n=this,r=n._handlers;return r[e]&&r[e].length>0?(t=Array.prototype.splice.call(arguments,1),r[e]=r[e].filter(function(e){return e.fn.apply(n,t),!e.once}),n):n},n}(),e.Observable=function(){function n(n){t.call(this),this.uuid=e.uuid(),this.value=n}var t=e.EventEmitter,r=n.prototype=Object.create(t.prototype);return r.set=function(e){var t=this,n=t.value;return t.emit("set"),n!==e&&(t.value=e,t.emit("change",e,n)),t},r.get=function(){return this.emit("get"),this.value},n}(),e.Computed=function(){function r(r){var i=this;n.call(i),i.uuid=e.uuid(),i.read=r,i.value=t,i.shouldRecompute=!0,i.lastContext=t}var n=e.EventEmitter,i=r.prototype=Object.create(n.prototype);return i.get=function(e){var t=this,n=t.value,r;return t.lastContext=e,t.emit("get"),t.shouldRecompute&&(t.emit("start"),r=t.read.call(e),t.shouldRecompute=!1,t.emit("end"),n!==r&&(t.value=r,t.emit("change",r,n))),t.value},i.recompute=function(){return this.shouldRecompute=!0,this.get(this.lastContext)},r}(),e.Subscriber=function(){function r(r){var i=this;n.call(i),i.uuid=e.uuid(),i.fn=r,i.lastContext=t}var n=e.EventEmitter,i=r.prototype=Object.create(n.prototype);return i.run=function(e){var t=this;return t.lastContext=e,t.emit("start"),t.fn.call(e),t.emit("end"),e},i.rerun=function(){return this.run(this.lastContext)},r}(),e.IsolationCallContext=function(){function t(t){this.uuid=t,this.dependencies=new e.Set,this.relations=new e.Set}return t}(),e.Isolation=function(){function s(){var n=this;n._observables={},n._computed={},n._subscribers={},n._callStack=[],n._currentContext=t,n._contexts={},n._computedToRecompute=new r,n._subscribersToRerun=new r,n.resolve=e.deferred(50,this.resolve)}var n=e.EventEmitter,r=e.Set,i=e.IsolationCallContext,o=s.prototype;return o.observable=function(t){var n=new e.Observable(t);return this.registerObservable(n)},o.registerObservable=function(e){function r(t){return arguments.length>0?(e.set(t),this):e.get()}var t=this,n=e.uuid;return t._observables[n]=e,e.on("change",function(){t.registerChanged(n)}),e.on("get",function(){t.registerDependency(n)}),r},o.computed=function(t){var n=new e.Computed(t);return this.registerComputed(n)},o.registerComputed=function(e){function r(){return e.get(this)}var t=this,n=e.uuid;return t._computed[n]=e,e.on("change",function(){t.registerChanged(n)}),e.on("start",function(){t.setContext(n)}),e.on("end",function(){t.closeContext()}),e.on("get",function(){t.registerDependency(n)}),r},o.subscribe=function(t){var n=new e.Subscriber(t);return this.registerSubscriber(n)},o.registerSubscriber=function(e){function r(){return e.run(this)}var t=this,n=e.uuid;return t._subscribers[n]=e,e.on("start",function(){t.setContext(n)}),e.on("end",function(){t.closeContext()}),r},o.setContext=function(e){var t=this,n=t._currentContext,r=t._contexts;n&&t._callStack.unshift(n),r[e]||(r[e]=new i(e)),n=t._currentContext=r[e],n.dependencies.elements.forEach(function(n){t.removeRelation(e,n)}),n.dependencies.clear()},o.closeContext=function(){this._currentContext=this._callStack.shift()},o.registerDependency=function(e){var t=this._currentContext;t&&(t.dependencies.add(e),this.registerRelation(t.uuid,e))},o.registerRelation=function(e,t){var n=this._contexts;n[t]||(n[t]=new i(t)),n[t].relations.add(e)},o.removeRelation=function(e,t){var n=this._contexts[t];n.relations.remove(e)},o.registerChanged=function(e){var t=this,n=t._contexts[e],r;n&&(r=n.relations.elements,r.length>0&&(r.forEach(function(e){if(!t._currentContext||t._currentContext.uuid!==e)t._computed[e]?t._computedToRecompute.add(e):t._subscribers[e]&&t._subscribersToRerun.add(e)}),t.resolve()))},o.resolve=function(){var e=this,t=e._computedToRecompute,n=e._subscribersToRerun;t.elements.length>0?(e._computedToRecompute=new r,t.elements.forEach(function(t){e._computed[t].recompute()}),e.resolve()):n.elements.length>0&&(e._subscribersToRerun=new r,n.elements.forEach(function(t){e._subscribers[t].rerun()}),e.resolve())},s}()})(window.Zero={},undefined);