(function(t){window.Zero||(window.Zero={}),t.DEBUG={},["Arguments","Function","String","Number","Date","RegExp"].forEach(function(e){"use strict";t.DEBUG["is"+e]=function(t){return Object.prototype.toString.call(t)==="[object "+e+"]"}}),t.noop=function(t){return t},t.uuid=function(){"use strict";var t=1;return function(){return t++,t}}(),t.deferred=function(t,e){"use strict";var n;return function(){n&&clearTimeout(n),n=setTimeout(e.bind(this),t)}},t.Set=function(){"use strict";function t(t){if(t&&!Array.isArray(t))throw Error("Elements must be an array");this.elements=t||[]}var e=t.prototype;return e.has=function(t){return this.elements.indexOf(t)>=0},e.add=function(t){this.has(t)||this.elements.push(t)},e.remove=function(t){var e=this.elements.indexOf(t);e>0&&this.elements.splice(e,1)},e.clear=function(){this.elements=[]},t}(),t.EventHandler=function(){"use strict";function t(t,e){if("function"!=typeof t)throw Error("Event handler must be a function");this.fn=t,this.once=!!e}return t}(),t.EventEmitter=function(){"use strict";function e(){this._handlers={}}var n=t.EventHandler,r=e.prototype;return r.on=function(e,r){if(!t.DEBUG.isString(e))throw Error("Event name must be a string");if(!(t.DEBUG.isFunction(r)||r instanceof n))throw Error("Event handler must be a function or instance of EventHandler");var i=r instanceof n?r:new n(r,!1),o=this._handlers;return o[e]||(o[e]=[]),o[e].push(i),this},r.off=function(e,r){if(e&&!t.DEBUG.isString(e))throw Error("Event name must be a string");if(r&&!(t.DEBUG.isFunction(r)||r instanceof n))throw Error("Event handler must be a function or instance of EventHandler");var i,o=this,s=o._handlers;return e?s[e]&&s[e].length>0?r?(i=r instanceof n?r.fn:r,s[e]=s[e].filter(function(t){return t.fn!==i}),o):(s[e]=[],o):o:(s=o._handlers={},o)},r.once=function(e,r){if(!t.DEBUG.isString(e))throw Error("Event name must be a string");if(!(t.DEBUG.isFunction(r)||r instanceof n))throw Error("Event handler must be a function or instance of EventHandler");var i=new n(r instanceof n?r.fn:r,!0);return this.on(e,i)},r.emit=function(){var e=arguments[0];if(!t.DEBUG.isString(e))throw Error("Event name must be a string");var n,r=this,i=r._handlers;return i[e]&&i[e].length>0?(n=arguments.length>1?Array.prototype.splice.call(arguments,1):[],i[e]=i[e].filter(function(t){return t.fn.apply(r,n),!t.once}),r):r},e}(),t.Observable=function(){"use strict";function e(e){var r=this;n.call(r),r.uuid=t.uuid(),r.value=e}var n=t.EventEmitter,r=e.prototype=Object.create(n.prototype);return r.set=function(t){var e=this,n=e.value;return e.emit("set"),n!==t&&(e.value=t,e.emit("change",t,n)),e},r.get=function(){return this.emit("get"),this.value},e}(),t.Computed=function(){"use strict";function e(e){if(!t.DEBUG.isFunction(e))throw Error("Computed should be a function");var r=this;n.call(r),r.uuid=t.uuid(),r.read=e,r.value=void 0,r.shouldRecompute=!0,r.lastContext=void 0}var n=t.EventEmitter,r=e.prototype=Object.create(n.prototype);return r.get=function(t){var e,n=this,r=n.value;return n.lastContext=t,n.emit("get"),n.shouldRecompute&&(n.emit("start"),e=n.read.call(t),n.shouldRecompute=!1,n.emit("end"),r!==e&&(n.value=e,n.emit("change",e,r))),n.value},r.recompute=function(){return this.shouldRecompute=!0,this.get(this.lastContext)},e}(),t.Subscriber=function(){"use strict";function e(e){if(!t.DEBUG.isFunction(e))throw Error("Subscribe function must be a function");var r=this;n.call(r),r.uuid=t.uuid(),r.fn=e,r.lastContext=void 0}var n=t.EventEmitter,r=e.prototype=Object.create(n.prototype);return r.run=function(t){var e=this;return e.lastContext=t,e.emit("start"),e.fn.call(t),e.emit("end"),t},r.rerun=function(){return this.run(this.lastContext)},e}(),t.IsolationCallContext=function(){"use strict";function e(e){if(!e)throw Error("uuid must present");this.uuid=e,this.dependencies=new t.Set,this.relations=new t.Set}return e}(),t.Isolation=function(){"use strict";function e(){var e=this;e._observables={},e._computed={},e._subscribers={},e._callStack=[],e._currentIsolationCallContext=void 0,e._isolationCallContexts={},e._computedToRecompute=new t.Set,e._subscribersToRerun=new t.Set,e.resolve=t.deferred(10,e.resolve)}var n=t.IsolationCallContext,r=e.prototype;return r.observable=function(e){var n=new t.Observable(e);return this.registerObservable(n)},r.registerObservable=function(t){function e(e){return arguments.length>0?(t.set(e),this):t.get()}var n=this,r=t.uuid;return n._observables[r]=t,t.on("get",function(){n.registerDependency(r)}),t.on("change",function(){n.registerChanged(r)}),e},r.computed=function(e){var n=new t.Computed(e);return this.registerComputed(n)},r.registerComputed=function(t){function e(){return t.get(this)}var n=this,r=t.uuid;return n._computed[r]=t,t.on("get",function(){n.registerDependency(r)}),t.on("start",function(){n.setContext(r)}),t.on("end",function(){n.closeContext()}),t.on("change",function(){n.registerChanged(r)}),e},r.subscribe=function(e){var n=new t.Subscriber(e);return this.registerSubscriber(n)},r.registerSubscriber=function(t){function e(){return t.run(this)}var n=this,r=t.uuid;return n._subscribers[r]=t,t.on("start",function(){n.setContext(r)}),t.on("end",function(){n.closeContext()}),e},r.deffer=function(e,n){function r(){i.setContext(o.uuid,!0);var t=e.call(n||this);return i.closeContext(),t}if(!t.DEBUG.isFunction(e))throw Error("Binding value must be a function");var i=this,o=i._currentIsolationCallContext;return r},r.setContext=function(t,e){var r=this,i=r._currentIsolationCallContext,o=r._isolationCallContexts;i&&r._callStack.unshift(i),o[t]||(o[t]=new n(t)),i=r._currentIsolationCallContext=o[t],e||(i.dependencies.elements.forEach(function(e){r.removeRelation(t,e)}),i.dependencies.clear())},r.closeContext=function(){this._currentIsolationCallContext=this._callStack.shift()},r.registerDependency=function(t){var e=this._currentIsolationCallContext;if(e){if(e.relations.has(t))throw Error("Recoursive call");e.dependencies.add(t),this.registerRelation(e.uuid,t)}},r.registerRelation=function(t,e){var r=this._isolationCallContexts;if(r[e]||(r[e]=new n(e)),r[e].dependencies.has(t))throw Error("Recoursive call");r[e].relations.add(t)},r.removeRelation=function(t,e){var n=this._isolationCallContexts[e];n.relations.remove(t)},r.registerChanged=function(t){var e,n=this,r=n._isolationCallContexts[t];r&&(e=r.relations.elements,e.length>0&&(e.forEach(function(t){n._currentIsolationCallContext&&n._currentIsolationCallContext.uuid===t||(n._computed[t]?n._computedToRecompute.add(t):n._subscribers[t]&&n._subscribersToRerun.add(t))}),n.resolve()))},r.resolve=function(){for(var t,e,n=this;n._computedToRecompute.elements.length>0;)t=n._computedToRecompute.elements.shift(),n._computed[t].recompute();for(;n._subscribersToRerun.elements.length>0;)e=n._subscribersToRerun.elements.shift(),n._subscribers[e].rerun()},e}()})(window.Zero={});