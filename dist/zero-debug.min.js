(function(e,t){window.Zero||(e={}),e.DEBUG={},["Arguments","Function","String","Number","Date","RegExp"].forEach(function(t){e.DEBUG["is"+t]=function(e){return Object.prototype.toString.call(e)=="[object "+t+"]"}}),e.noop=function(e){return e},e.uuid=function(){var e=1;return function(){return e++}}(),e.deferred=function(e,t){var n;return function(){n&&clearTimeout(n),n=setTimeout(t.bind(this),e)}},e.EventHandler=function(){function e(e,t){if(typeof e!="function")throw new Error("Event handler must be a function");this.fn=e,this.once=!!t}return e}(),e.EventEmitter=function(){function n(){this._handlers={}}var t=e.EventHandler,r=n.prototype;return r.on=function(n,r){if(!e.DEBUG.isString(n))throw new Error("Event name must be a string");if(!(e.DEBUG.isFunction(r)||r instanceof e.EventHandler))throw new Error("Event handler must be a function or instance of EventHandler");var i=r instanceof t?r:new t(r,!1),s=this._handlers;return s[n]||(s[n]=[]),s[n].push(i),this},r.off=function(n,r){if(n&&!e.DEBUG.isString(n))throw new Error("Event name must be a string");if(r&&!(e.DEBUG.isFunction(r)||r instanceof e.EventHandler))throw new Error("Event handler must be a function or instance of EventHandler");var i,s=this,o=s._handlers;return n?o[n]&&o[n].length>0?r?(i=r instanceof t?r.fn:r,o[n]=o[n].filter(function(e){return e.fn!==i}),s):(o[n]=[],s):s:(o=s._handlers={},s)},r.once=function(n,r){if(!e.DEBUG.isString(n))throw new Error("Event name must be a string");if(!(e.DEBUG.isFunction(r)||r instanceof e.EventHandler))throw new Error("Event handler must be a function or instance of EventHandler");var i=new t(r instanceof t?r.fn:r,!0);return this.on(n,i)},r.emit=function(){var t=arguments[0];if(!e.DEBUG.isString(t))throw new Error("Event name must be a string");var n,r=this,i=r._handlers;return i[t]&&i[t].length>0?(n=Array.prototype.splice.call(arguments,1),i[t]=i[t].filter(function(e){return e.fn.apply(r,n),!e.once}),r):r},n}(),e.Observable=function(){function n(n){t.call(this),this.uuid=e.uuid(),this.value=n}var t=e.EventEmitter,r=n.prototype=Object.create(t.prototype);return r.set=function(e){var t=this,n=t.value;return t.emit("set"),n!==e&&(t.value=e,t.emit("change",e,n)),t},r.get=function(){return this.emit("get"),this.value},n}(),e.Computed=function(){function r(r){if(!e.DEBUG.isFunction(r))throw new Error("Computed should be a function");var i=this;n.call(i),i.uuid=e.uuid(),i.read=r,i.value=t,i.shouldRecompute=!0,i.lastContext=t}var n=e.EventEmitter,i=r.prototype=Object.create(n.prototype);return i.get=function(e){var t=this,n=t.value,r;return t.lastContext=e,t.emit("get"),t.shouldRecompute&&(t.emit("start"),r=t.read.call(e),t.shouldRecompute=!1,n!==r&&(t.value=r,t.emit("change",r,n)),t.emit("end")),t.value},i.recompute=function(){return this.get(this.lastContext)},r}(),e.Subscriber=function(){function r(r){if(!e.DEBUG.isFunction(r))throw new Error("Subscribe function must be a function");var i=this;n.call(i),i.uuid=e.uuid(),i.fn=r,i.lastContext=t}var n=e.EventEmitter,i=r.prototype=Object.create(n.prototype);return i.run=function(e){var t=this;return t.lastContext=e,t.emit("start"),t.fn.call(e),t.emit("end"),e},i.rerun=function(){return this.run(this.lastContext)},r}(),e.IsolationCallContext=function(){function e(e){if(!e)throw new Error("uuid must present");this.uuid=e,this.dependencies=[],this.relations=[]}return e}(),e.Isolation=function(){function r(){function r(t){e.registerDependency(t)}function i(t){e.setContext(t)}function s(t){e.closeContext()}var e=this;n.call(e),e.observables={},e.computed={},e.subscribers={},e.callStack=[],e.currentContext=t,e.contexts={},e.on("read:observable",r),e.on("read:computed",r),e.on("start:computed",i),e.on("end:computed",s),e.on("start:subscriber",i),e.on("end:subscriber",s)}var n=e.EventEmitter,i=r.prototype=Object.create(n.prototype);return i.observable=function(t){var n=new e.Observable(t);return this.registerObservable(n)},i.registerObservable=function(e){function r(){return arguments.length>0?(e.set(arguments[0]),this):e.get()}var t=this,n=e.uuid;return t.observables[n]=e,e.on("get",function(){t.emit("read:observable",n)}),e.on("change",function(){t.emit("write:observable",n)}),r},i.computed=function(t){var n=new e.Computed(t);return this.registerComputed(n)},i.registerComputed=function(e){function r(){return e.get(this)}var t=this,n=e.uuid;return t.computed[n]=e,e.on("get",function(){t.emit("read:computed",n)}),e.on("change",function(){t.emit("write:computed",n)}),e.on("start",function(){t.emit("start:compute",n)}),e.on("end",function(){t.emit("end:compute",n)}),r},i.subscribe=function(t){var n=new e.Subscriber;return this.registerSubscriber(n)},i.registerSubscriber=function(e){function r(){return e.run(this)}var t=this,n=e.uuid;return t.subscribers[n]=e,e.on("start",function(){t.emit("start:subscriber",n)}),e.on("end",function(){t.emit("end:subscriber",n)}),r},i.registerDependency=function(e){var t=this.currentContext;if(t){if(t.uuid==e)throw new Error("Recoursive call");t.dependencies.push(e),this.registerRelation(t.uuid,e)}},i.registerRelation=function(t,n){var r=this.contexts;r[n]||(r[n]=new e.IsolationCallContext),r[n].relations.push(t)},i.removeRelation=function(e,t){var n=this.contexts[t];n.relations=n.relations.filter(function(t){return t!==e})},i.setContext=function(t){var n=this,r=n.currentContext,i=n.contexts;r&&n.callStack.unshift(r),i[t]||(i[t]=new e.IsolationCallContext(t)),r=n.currentContext=i[t],r.dependencies.forEach(function(e){n.removeRelation(t,e)}),r.dependencies=[]},i.closeContext=function(){this.currentContext=this.callStack.shift()},r}()})(window.Zero={},undefined);