Zero={},Zero.DEBUG={},["Arguments","Function","String","Number","Date","RegExp"].forEach(function(e){Zero.DEBUG["is"+e]=function(t){return Object.prototype.toString.call(t)=="[object "+e+"]"}}),Zero.noop=function(e){return e},Zero.uuid=function(){var e=1;return function(){return e++}}(),Zero.deferred=function(){function e(e,t){var n;return function(){n&&clearTimeout(n),n=setTimeout(t.bind(this),e)}}return e}(),Zero.EventHandler=function(){function e(e,t){if(typeof e!="function")throw new Error("Event handler must be a function");this.fn=e,this.once=!!t}return e}(),Zero.EventEmitter=function(){function t(){this._handlers={}}var e=Zero.EventHandler,n=t.prototype;return n.on=function(t,n){if(!Zero.DEBUG.isString(t))throw new Error("Event name must be a string");if(!(Zero.DEBUG.isFunction(n)||n instanceof Zero.EventHandler))throw new Error("Event handler must be a function or instance of EventHandler");var r=n instanceof e?n:new e(n,!1),i=this._handlers;return i[t]||(i[t]=[]),i[t].push(r),this},n.off=function(t,n){if(t&&!Zero.DEBUG.isString(t))throw new Error("Event name must be a string");if(n&&!(Zero.DEBUG.isFunction(n)||n instanceof Zero.EventHandler))throw new Error("Event handler must be a function or instance of EventHandler");var r,i=this,s=i._handlers;return t?s[t]&&s[t].length>0?n?(r=n instanceof e?n.fn:n,s[t]=s[t].filter(function(e){return e.fn!==r}),i):(s[t]=[],i):i:(s=i._handlers={},i)},n.once=function(t,n){if(!Zero.DEBUG.isString(t))throw new Error("Event name must be a string");if(!(Zero.DEBUG.isFunction(n)||n instanceof Zero.EventHandler))throw new Error("Event handler must be a function or instance of EventHandler");var r=new e(n instanceof e?n.fn:n,!0);return this.on(t,r)},n.emit=function(){var e=arguments[0];if(!Zero.DEBUG.isString(e))throw new Error("Event name must be a string");var t,n=this,r=n._handlers;return r[e]&&r[e].length>0?(t=Array.prototype.splice.call(arguments,1),r[e]=r[e].filter(function(e){return e.fn.apply(n,t),!e.once}),n):n},t}(),Zero.Observable=function(){function t(t){e.call(this),this.uuid=Zero.uuid(),this.value=t}var e=Zero.EventEmitter,n=t.prototype=Object.create(e.prototype);return n.set=function(e){var t=this,n=t.value;return t.emit("set"),n!==e&&(t.value=e,t.emit("change",e,n)),t},n.get=function(){return this.emit("get"),this.value},t}(),Zero.Computed=function(){function t(t){if(typeof t!="function")throw new Error("Computed should be a function");var n=this;e.call(n),n.uuid=Zero.uuid(),n.read=t,n.value=undefined,n.shouldRecompute=!0,n.lastContext=undefined}var e=Zero.EventEmitter,n=t.prototype=Object.create(e.prototype);return n.get=function(e){var t=this,n=t.value,r;return t.lastContext=e,t.emit("get"),t.shouldRecompute&&(t.emit("start"),r=t.read.call(e),t.shouldRecompute=!1,n!==r&&(t.value=r,t.emit("change",r,n)),t.emit("end")),t.value},n.recompute=function(){return this.get(this.lastContext)},t}(),Zero.Subscriber=function(){function t(t){if(!Zero.DEBUG.isFunction(t))throw new Error("Subscribe function must be a function");var n=this;e.call(n),n.uuid=Zero.uuid(),n.fn=t,n.lastContext=undefined}var e=Zero.EventEmitter,n=t.prototype=Object.create(e.prototype);return n.run=function(e){var t=this;return t.lastContext=e,t.emit("start"),t.fn.call(e),t.emit("end"),e},n.rerun=function(){return this.run(this.lastContext)},t}(),Zero.IsolationCallContext=function(){function e(e){if(!e)throw new Error("uuid must present");this.uuid=e,this.dependencies=[],this.relations=[]}return e}(),Zero.Isolation=function(){function t(){function n(e){t.registerDependency(e)}function r(e){t.setContext(e)}function i(e){t.closeContext()}var t=this;e.call(t),t.observables={},t.computed={},t.subscribers={},t.callStack=[],t.currentContext=undefined,t.contexts={},t.on("read:observable",n),t.on("read:computed",n),t.on("start:computed",r),t.on("end:computed",i),t.on("start:subscriber",r),t.on("end:subscriber",i)}var e=Zero.EventEmitter,n=t.prototype=Object.create(e.prototype);return n.registerDependency=function(e){if(this.currentContext){if(this.currentContext.uuid==e)throw new Error("Recoursive call");this.currentContext.dependencies.push(e),this.registerRelation(this.currentContext.uuid,e)}},n.registerRelation=function(e,t){this.contexts[t]||(this.contexts[t]=new Zero.IsolationCallContext),this.contexts[t].relations.push(e)},n.removeRelation=function(e,t){this.contexts[t].relations=this.contexts[t].relations.filter(function(t){return t!==e})},n.setContext=function(e){var t=this;t.currentContext&&t.callStack.unshift(t.currentContext),t.contexts[e]||(t.contexts[e]=new Zero.IsolationCallContext(e)),t.currentContext=t.contexts[e],t.currentContext.dependencies.forEach(function(n){t.removeRelation(e,n)}),t.currentContext.dependencies=[]},n.closeContext=function(){this.currentContext=this.callStack.shift()},n.observable=function(e){var t=new Zero.Observable(e);return this.registerObservable(t)},n.registerObservable=function(e){function r(){return arguments.length>0?(e.set(arguments[0]),this):e.get()}var t=this,n=e.uuid;return t.observables[n]=e,e.on("get",function(){t.emit("read:observable",n)}),e.on("change",function(){t.emit("write:observable",n)}),r},n.computed=function(e){var t=new Zero.Computed(e);return this.registerComputed(t)},n.registerComputed=function(e){function r(){return e.get(this)}var t=this,n=e.uuid;return t.computed[n]=e,e.on("get",function(){t.emit("read:computed",n)}),e.on("change",function(){t.emit("write:computed",n)}),e.on("start",function(){t.emit("start:compute",n)}),e.on("end",function(){t.emit("end:compute",n)}),r},n.subscribe=function(e){var t=new Zero.Subscriber;return this.registerSubscriber(t)},n.registerSubscriber=function(e){function r(){return e.run(this)}var t=this,n=e.uuid;return t.subscribers[n]=e,e.on("start",function(){t.emit("start:subscriber",n)}),e.on("end",function(){t.emit("end:subscriber",n)}),r},t}();