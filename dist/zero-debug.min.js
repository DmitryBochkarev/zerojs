(function(e,t){window.Zero||(e={}),e.DEBUG={},["Arguments","Function","String","Number","Date","RegExp"].forEach(function(t){e.DEBUG["is"+t]=function(e){return Object.prototype.toString.call(e)=="[object "+t+"]"}}),e.noop=function(e){return e},e.uuid=function(){var e=1;return function(){return e++}}(),e.deferred=function(e,t){var n;return function(){n&&clearTimeout(n),n=setTimeout(t.bind(this),e)}},e.Set=function(){function e(e){if(e&&!Array.isArray(e))throw new Error("Elements must be an array");this.elements=e||[]}var t=e.prototype;return t.has=function(e){return this.elements.indexOf(e)>=0},t.add=function(e){this.has(e)||this.elements.push(e)},t.remove=function(e){var t=this.elements.indexOf(e);t>0&&this.elements.splice(t,1)},t.clear=function(){this.elements=[]},e}(),e.EventHandler=function(){function e(e,t){if(typeof e!="function")throw new Error("Event handler must be a function");this.fn=e,this.once=!!t}return e}(),e.EventEmitter=function(){function n(){this._handlers={}}var t=e.EventHandler,r=n.prototype;return r.on=function(n,r){if(!e.DEBUG.isString(n))throw new Error("Event name must be a string");if(!(e.DEBUG.isFunction(r)||r instanceof e.EventHandler))throw new Error("Event handler must be a function or instance of EventHandler");var i=r instanceof t?r:new t(r,!1),s=this._handlers;return s[n]||(s[n]=[]),s[n].push(i),this},r.off=function(n,r){if(n&&!e.DEBUG.isString(n))throw new Error("Event name must be a string");if(r&&!(e.DEBUG.isFunction(r)||r instanceof e.EventHandler))throw new Error("Event handler must be a function or instance of EventHandler");var i,s=this,o=s._handlers;return n?o[n]&&o[n].length>0?r?(i=r instanceof t?r.fn:r,o[n]=o[n].filter(function(e){return e.fn!==i}),s):(o[n]=[],s):s:(o=s._handlers={},s)},r.once=function(n,r){if(!e.DEBUG.isString(n))throw new Error("Event name must be a string");if(!(e.DEBUG.isFunction(r)||r instanceof e.EventHandler))throw new Error("Event handler must be a function or instance of EventHandler");var i=new t(r instanceof t?r.fn:r,!0);return this.on(n,i)},r.emit=function(){var t=arguments[0];if(!e.DEBUG.isString(t))throw new Error("Event name must be a string");var n,r=this,i=r._handlers;return i[t]&&i[t].length>0?(n=Array.prototype.splice.call(arguments,1),i[t]=i[t].filter(function(e){return e.fn.apply(r,n),!e.once}),r):r},n}(),e.Observable=function(){function n(n){t.call(this),this.uuid=e.uuid(),this.value=n}var t=e.EventEmitter,r=n.prototype=Object.create(t.prototype);return r.set=function(e){var t=this,n=t.value;return t.emit("set"),n!==e&&(t.value=e,t.emit("change",e,n)),t},r.get=function(){return this.emit("get"),this.value},n}(),e.Computed=function(){function r(r){if(!e.DEBUG.isFunction(r))throw new Error("Computed should be a function");var i=this;n.call(i),i.uuid=e.uuid(),i.read=r,i.value=t,i.shouldRecompute=!0,i.lastContext=t}var n=e.EventEmitter,i=r.prototype=Object.create(n.prototype);return i.get=function(e){var t=this,n=t.value,r;return t.lastContext=e,t.emit("get"),t.shouldRecompute&&(t.emit("start"),r=t.read.call(e),t.shouldRecompute=!1,n!==r&&(t.value=r,t.emit("change",r,n)),t.emit("end")),t.value},i.recompute=function(){return this.shouldRecompute=!0,this.get(this.lastContext)},r}(),e.Subscriber=function(){function r(r){if(!e.DEBUG.isFunction(r))throw new Error("Subscribe function must be a function");var i=this;n.call(i),i.uuid=e.uuid(),i.fn=r,i.lastContext=t}var n=e.EventEmitter,i=r.prototype=Object.create(n.prototype);return i.run=function(e){var t=this;return t.lastContext=e,t.emit("start"),t.fn.call(e),t.emit("end"),e},i.rerun=function(){return this.run(this.lastContext)},r}(),e.IsolationCallContext=function(){function t(t){if(!t)throw new Error("uuid must present");this.uuid=t,this.dependencies=new e.Set,this.relations=new e.Set}return t}(),e.Isolation=function(){function s(){var n=this;n._observables={},n._computed={},n._subscribers={},n._callStack=[],n._currentContext=t,n._contexts={},n._computedToRecompute=new r,n._subscribersToRerun=new r,n.resolve=e.deferred(10,this.resolve)}var n=e.EventEmitter,r=e.Set,i=e.IsolationCallContext,o=s.prototype;return o.observable=function(t){var n=new e.Observable(t);return this.registerObservable(n)},o.registerObservable=function(e){function r(t){return arguments.length>0?(e.set(t),this):e.get()}var t=this,n=e.uuid;return t._observables[n]=e,e.on("get",function(){t.registerDependency(n)}),e.on("change",function(){t.registerChanged(n)}),r},o.computed=function(t){var n=new e.Computed(t);return this.registerComputed(n)},o.registerComputed=function(e){function r(){return e.get(this)}var t=this,n=e.uuid;return t._computed[n]=e,e.on("get",function(){t.registerDependency(n)}),e.on("change",function(){t.registerChanged(n)}),e.on("start",function(){t.setContext(n)}),e.on("end",function(){t.closeContext()}),r},o.subscribe=function(t){var n=new e.Subscriber(t);return this.registerSubscriber(n)},o.registerSubscriber=function(e){function r(){return e.run(this)}var t=this,n=e.uuid;return t._subscribers[n]=e,e.on("start",function(){t.setContext(n)}),e.on("end",function(){t.closeContext()}),r},o.setContext=function(e){var t=this,n=t._currentContext,r=t._contexts;n&&t._callStack.unshift(n),r[e]||(r[e]=new i(e)),n=t._currentContext=r[e],n.dependencies.elements.forEach(function(n){t.removeRelation(e,n)}),n.dependencies.clear()},o.closeContext=function(){this._currentContext=this._callStack.shift()},o.registerDependency=function(e){var t=this._currentContext;if(t){if(t.uuid==e)throw new Error("Recoursive call");t.dependencies.add(e),this.registerRelation(t.uuid,e)}},o.registerRelation=function(e,t){var n=this._contexts;n[t]||(n[t]=new i(t)),n[t].relations.add(e)},o.removeRelation=function(e,t){var n=this._contexts[t];n.relations.remove(e)},o.registerChanged=function(e){var t=this,n=t._contexts[e],r;n&&(r=n.relations.elements,r.length>0&&(r.forEach(function(e){t._computed[e]?t._computedToRecompute.add(e):t._subscribers[e]&&t._subscribersToRerun.add(e)}),t.resolve()))},o.resolve=function(){var e=this,t=e._computedToRecompute,n=e._subscribersToRerun;n.elements.length>0&&(t.elements.length>0?(e._computedToRecompute=new r,t.elements.forEach(function(t){e._computed[t].recompute()}),e.resolve()):(e._subscribersToRerun=new r,n.elements.forEach(function(t){e._subscribers[t].rerun()}),e.resolve()))},s}()})(window.Zero={},undefined);